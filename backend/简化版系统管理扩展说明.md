# 车载多模态交互系统扩展模块

本项目为车载多模态交互系统提供两个重要的扩展模块，用于增强系统的分析能力和个性化体验。

## 模块说明

### 1. 日志分析器 (log_analyzer.py)

提供系统运行日志的深度分析功能，包括：

- 用户行为分析
- 交互模式识别
- 系统使用报告生成
- 改进建议提供

主要功能：
```python
analyzer = LogAnalyzer()
# 分析用户行为
behavior = analyzer.analyze_user_behavior('driver1')
# 获取改进建议
suggestions = analyzer.get_improvement_suggestions('driver1')
# 生成系统报告
report = analyzer.generate_system_report()
```

### 2. 个性化配置分析器 (profile_analytics.py)

提供用户配置的智能分析和推荐功能，包括：

- 用户习惯分析
- 个性化推荐
- 配置自动更新
- 使用报告生成

主要功能：
```python
analytics = ProfileAnalytics()
# 分析常用模式
patterns = analytics.analyze_common_patterns()
# 获取个性化推荐
recommendations = analytics.get_personalized_recommendations('driver1')
# 更新用户配置
analytics.update_profile_based_on_interaction('driver1', '语音', '打开导航')
```

## 系统要求

- Python 3.6+
- 依赖模块：json, datetime, threading, re

## 集成指南

### 1. 在main.py中集成日志分析器

```python
from log_analyzer import LogAnalyzer

class MultiModalApp:
    def __init__(self, root):
        # ... 现有初始化代码 ...
        self.log_analyzer = LogAnalyzer()
        
    def on_interaction_complete(self, mode, content):
        # 在交互完成后调用分析
        if hasattr(self, 'user_manager') and self.user_manager:
            username = self.user_manager.get_current_user().username
            self.log_analyzer.analyze_user_behavior(username)
```

### 2. 在main.py中集成配置分析器

```python
from profile_analytics import ProfileAnalytics

class MultiModalApp:
    def __init__(self, root):
        # ... 现有初始化代码 ...
        self.profile_analytics = ProfileAnalytics()
        
    def handle_scene_logic(self, gaze_result, headpose_result, gesture_result):
        # ... 现有场景处理代码 ...
        
        # 更新用户配置
        if hasattr(self, 'user_manager') and self.user_manager:
            username = self.user_manager.get_current_user().username
            self.profile_analytics.update_profile_based_on_interaction(
                username,
                SCENES[self.scene_idx]['name'],
                f"{gaze_result}|{gesture_result}"
            )
```

## 注意事项

1. 权限控制
   - 管理人员：可访问所有功能
   - 维护人员：可查看系统日志和分析报告
   - 驾驶员：只能查看/更新自己的配置
   - 乘客：仅可查看基本信息

2. 线程安全
   - 两个模块都实现了线程安全机制
   - 使用`threading.Lock()`保护数据访问
   - 建议在多线程环境中使用

3. 错误处理
   - 所有方法都包含适当的错误处理
   - 建议在集成时添加try-except块

## 示例用法

```python
# 初始化分析器
log_analyzer = LogAnalyzer()
profile_analytics = ProfileAnalytics()

# 分析用户行为并生成报告
behavior_analysis = log_analyzer.analyze_user_behavior('driver1')
suggestions = log_analyzer.get_improvement_suggestions('driver1')

# 更新用户配置并获取推荐
profile_analytics.update_profile_based_on_interaction('driver1', '语音', '打开导航')
recommendations = profile_analytics.get_personalized_recommendations('driver1')
```

## 文件结构

```
.
├── main.py                 # 主程序
├── log_analyzer.py         # 日志分析器
├── profile_analytics.py    # 配置分析器
├── user_profile.py         # 用户配置管理
├── user_manager.py         # 用户管理
├── log.txt                 # 系统日志
└── user_profiles/          # 用户配置文件目录
    ├── driver1.json
    ├── driver2.json
    └── ...
``` 